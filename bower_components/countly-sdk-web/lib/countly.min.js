(function(b){function S(){if(B){var a={name:B,segment:da};b.add_event({key:"[CLY]_view",dur:n()-C,segmentation:a});B=null}}function q(a){if(!z)if(!b.app_key||!b.device_id)j("app_key or device_id is missing");else{a.app_key=b.app_key;a.device_id=b.device_id;a.sdk_name=ea;a.sdk_version=fa;b.country_code&&(a.country_code=b.country_code);b.city&&(a.city=b.city);null!==b.ip_address&&(a.ip_address=b.ip_address);a.timestamp=T();var d=new Date;a.hour=d.getHours();a.dow=d.getDay();r.length>I&&r.shift();r.push(a);
p("cly_queue",r,!0)}}function J(){if("undefined"!==typeof b.q&&0<b.q.length){for(var a,d=0;d<b.q.length;d++)if(a=b.q[d],j("Processing queued call",a),"function"===typeof a)a();else if(a.constructor===Array&&0<a.length)if("undefined"!==typeof b[a[0]])b[a[0]].apply(null,a.slice(1));else{var e=a[0].replace("userData.","");"undefined"!==typeof b.userData[e]&&b.userData[e].apply(null,a.slice(1))}b.q=[]}x&&(K&&A)&&(a=n(),a-v>L&&(b.session_duration(a-v),v=a));0<s.length&&(s.length<=D?(q({events:JSON.stringify(s)}),
s=[]):(a=s.splice(0,D),q({events:JSON.stringify(a)})),p("cly_event",s));if(0<r.length&&M&&n()>U){M=!1;var g=r.shift();j("Processing request",g);var f=function(a,d){j("Request Finished",d,a);a&&(r.unshift(d),U=n()+N);p("cly_queue",r,!0);M=!0};try{j("Sending XML HTTP request");var c=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,h;a=[];for(var i in g)a.push(i+"="+encodeURIComponent(g[i]));h=a.join("&");i="GET";2E3<=h.length?i="POST":
b.force_post&&(i="POST");"GET"===i?c.open("GET",b.url+V+"?"+h,!0):(c.open("POST",b.url+V,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"));c.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof f&&f(!1,g):4===this.readyState&&(j("Failed Server XML HTTP request",this.status),"function"===typeof f&&f(!0,g))};"GET"==i?c.send():c.send(h)}catch(k){j("Failed XML HTTP request",k),"function"===typeof f&&f(!0,g)}}setTimeout(J,O)}
function W(){var a={};a._app_version=b.app_version;a._ua=navigator.userAgent;if(screen.width){var d=screen.width?parseInt(screen.width):0,e=screen.height?parseInt(screen.height):0;if(0!==d&&0!==e){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)d=Math.round(d*window.devicePixelRatio),e=Math.round(e*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var g=d,d=e,e=g;a._resolution=""+d+"x"+e}}window.devicePixelRatio&&(a._density=window.devicePixelRatio);
d=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof d&&(a._locale=d);if("undefined"!==typeof document.referrer&&document.referrer.length&&(d=X.exec(document.referrer))&&d[11]&&d[11]!=window.location.hostname){d=!1;if(y&&y.length)for(e=0;e<y.length;e++)try{if(RegExp(y[e]).test(document.referrer)){j("Ignored:",document.referrer);d=!0;break}}catch(f){}d||(a._store=document.referrer)}j("Got metrics",a);return a}function j(){b.debug&&"undefined"!==
typeof console&&(arguments[1]&&"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),console.log(Array.prototype.slice.call(arguments).join("\n")))}function n(){return Math.floor((new Date).getTime()/1E3)}function T(){var a=(new Date).getTime();E>=a?E++:E=a;return E}function P(a,d,e){if(a){var e=e||Y,b="";"object"===typeof a?"undefined"!==typeof a.stack?b=a.stack:("undefined"!==typeof a.name&&(b+=a.name+":"),"undefined"!==typeof a.message&&(b+=a.message+"\n"),"undefined"!==typeof a.fileName&&
(b+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(b+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(b+=":"+a.columnNumber)):b=a+"";d=d?!0:!1;a=W();b={_resolution:a._resolution,_error:b,_app_version:a._app_version,_run:n()-Z,_not_os_specific:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)b._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&(b._online=navigator.onLine?!0:!1);b._background=document.hasFocus()?!1:
!0;0<F.length&&(b._logs=F.join("\n"));F=[];b._nonfatal=d;b._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||"");"undefined"!==typeof e&&(b._custom=e);try{var f=document.createElement("canvas").getContext("experimental-webgl");b._opengl=f.getParameter(f.VERSION)}catch(c){}q({crash:JSON.stringify(b)})}}function $(a,d){for(var b={},g,f=0;f<d.length;f++)g=d[f],"undefined"!==typeof a[g]&&(b[g]=a[g]);return b}function aa(a){"undefined"==typeof a.pageY&&("number"==
typeof a.clientX&&document.documentElement)&&(a.pageX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return a}var fa="16.12",ea="javascript_native_web",ba=!1,x=!1,V="/i",O=500,I=1E3,r=[],s=[],F=[],w={},y=[],Y=null,K=!0,v,ca=0,B=null,C=0,Q=0,U=0,N=60,G=20,H=0,L=60,D=10,E=0,M=!0,da,X=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
ga=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,z=!1,A=!0,Z;b.init=function(a){if(!ba){Z=n();ba=!0;r=p("cly_queue")||
[];w={};s=p("cly_event")||[];a=a||{};O=a.interval||b.interval||O;I=a.queue_size||b.queue_size||I;N=a.fail_timeout||b.fail_timeout||N;G=a.inactivity_time||b.inactivity_time||G;L=a.session_update||b.session_update||L;D=a.max_events||b.max_events||D;b.ignore_prefetch=a.ignore_prefetch||b.ignore_prefetch||!0;b.debug=a.debug||b.debug||!1;b.app_key=a.app_key||b.app_key||null;var d=b,e;if(!(e=a.device_id))if(!(e=b.device_id))if(!(e=p("cly_id"))){var g=(new Date).getTime();e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var d=(g+16*Math.random())%16|0;g=Math.floor(g/16);return("x"==a?d:d&3|8).toString(16)})}d.device_id=e;d=b;e=a.url||b.url||"";e="/"==e.substr(e.length-1)?e.substr(0,e.length-1):e;d.url=e;b.app_version=a.app_version||b.app_version||"0.0";b.country_code=a.country_code||b.country_code||null;b.city=a.city||b.city||null;b.ip_address=a.ip_address||b.ip_address||null;b.ignore_bots=a.ignore_bots||b.ignore_bots||!0;b.force_post=a.force_post||b.force_post||!1;b.q=b.q||[];a.ignore_referrers&&a.ignore_referrers.constructor===
Array?y=a.ignore_referrers:b.ignore_referrers&&b.ignore_referrers.constructor===Array&&(y=b.ignore_referrers);""===b.url&&(j("Please provide server URL"),z=!0);b.ignore_prefetch&&("undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState)&&(z=!0);b.ignore_bots&&ga.test(navigator.userAgent)&&(z=!0);if(!z&&(j("Countly initialized"),b.q.constructor!==Array&&(b.q=[]),J(),p("cly_id",b.device_id),location.search)){a=location.search.substring(1).split("&");for(d=0;d<a.length;d++)e=
a[d].split("="),"cly_id"==e[0]?p("cly_cmp_id",e[1]):"cly_uid"==e[0]&&p("cly_cmp_uid",e[1])}}};b.begin_session=function(a){x||(j("Session started"),v=n(),x=!0,K=a?!1:!0,a={begin_session:1},a.metrics=JSON.stringify(W()),q(a))};b.session_duration=function(a){x&&(j("Session extended",a),q({session_duration:a}))};b.end_session=function(a){x&&(a=a||n()-v,j("Ending session"),S(),x=!1,q({end_session:1,session_duration:a}),J())};b.change_id=function(a,d){if(b.device_id!=a){d||(b.end_session(),w={});var e=
b.device_id;b.device_id=a;p("cly_id",b.device_id);j("Changing id");d?q({old_device_id:e}):b.begin_session(!K)}};b.add_event=function(a){if(a.key){a.count||(a.count=1);var d=$(a,["key","count","sum","dur","segmentation"]);d.timestamp=T();var b=new Date;d.hour=b.getHours();d.dow=b.getDay();s.push(d);p("cly_event",s);j("Adding event: ",a)}else j("Event must have key property")};b.start_event=function(a){w[a]?j("Timed event with key "+a+" already started"):w[a]=n()};b.end_event=function(a){"string"==
typeof a&&(a={key:a});a.key?w[a.key]?(a.dur=n()-w[a.key],b.add_event(a),delete w[a.key]):j("Timed event with key "+a.key+" was not started"):j("Event must have key property")};b.user_details=function(a){j("Adding userdetails: ",a);q({user_details:JSON.stringify($(a,"name username email organization phone picture gender byear custom".split(" ")))})};b.report_conversion=function(a,d){a=a||p("cly_cmp_id")||"cly_organic";d=d||p("cly_cmp_uid");a&&d?q({campaign_id:a,campaign_user:d}):a?q({campaign_id:a}):
j("No campaign data found")};var t={},u=function(a,d,b){t[a]||(t[a]={});"$push"==b||"$pull"==b||"$addToSet"==b?(t[a][b]||(t[a][b]=[]),t[a][b].push(d)):t[a][b]=d};b.userData={set:function(a,b){t[a]=b},set_once:function(a){u(a,1,"$setOnce")},increment:function(a){u(a,1,"$inc")},increment_by:function(a,b){u(a,b,"$inc")},multiply:function(a,b){u(a,b,"$mul")},max:function(a,b){u(a,b,"$max")},min:function(a,b){u(a,b,"$min")},push:function(a,b){u(a,b,"$push")},push_unique:function(a,b){u(a,b,"$addToSet")},
pull:function(a,b){u(a,b,"$pull")},save:function(){q({user_details:JSON.stringify({custom:t})});t={}}};b.track_errors=function(a){Y=a;window.onerror=function(a,b,g,f,c){if("undefined"!==typeof c)P(c,!1);else{var f=f||window.event&&window.event.errorCharacter,h="";"undefined"!==typeof a&&(h+=a+"\n");"undefined"!==typeof b&&(h+="at "+b);"undefined"!==typeof g&&(h+=":"+g);"undefined"!==typeof f&&(h+=":"+f);h+="\n";try{for(var i=[],k=arguments.callee.caller;k;)i.push(k.name),k=k.caller;h+=i.join("\n")}catch(j){}P(h,
!1)}}};b.log_error=function(a,b){P(a,!0,b)};b.add_log=function(a){F.push(a)};b.stop_time=function(){A&&(A=!1,ca=n()-v,Q=n()-C)};b.start_time=function(){A||(A=!0,v=n()-ca,C=n()-Q,Q=0)};b.track_sessions=function(){function a(){document[e]?b.stop_time():b.start_time()}function d(){H>=G&&b.start_time();H=0}b.begin_session();b.start_time();m(window,"beforeunload",function(){b.end_session()});m(window,"unload",function(){b.end_session()});var e="hidden";e in document?document.addEventListener("visibilitychange",
a):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(e="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(m(window,"focusin",function(){b.start_time()}),m(window,"focusout",function(){b.stop_time()})):(m(window,"focus",function(){b.start_time()}),m(window,"blur",function(){b.stop_time()}),m(window,"pageshow",function(){b.start_time()}),m(window,
"pagehide",function(){b.stop_time()}));m(window,"mousemove",d);m(window,"click",d);m(window,"keydown",d);m(window,"scroll",d);setInterval(function(){H++;H>=G&&b.stop_time()},6E4)};b.track_pageview=function(a,d){S();a&&a.constructor===Array&&(d=a,a=null);a=a||window.location.pathname;if(d&&d.length)for(var e=0;e<d.length;e++)try{if(RegExp(d[e]).test(a)){j("Ignored:",a);return}}catch(g){}B=a;C=n();e={name:a,visit:1,domain:window.location.hostname};if("undefined"!==typeof document.referrer&&document.referrer.length){var f=
X.exec(document.referrer);f&&(f[11]&&f[11]!=window.location.hostname)&&(e.start=1)}b.add_event({key:"[CLY]_view",segmentation:e})};b.track_view=function(a,d){b.track_pageview(a,d)};b.track_clicks=function(a){var a=a||document,d=!0;m(a,"click",function(a){if(d){d=!1;aa(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var g;g=document;g=Math.max(Math.max(g.body.scrollHeight,g.documentElement.scrollHeight),Math.max(g.body.offsetHeight,g.documentElement.offsetHeight),Math.max(g.body.clientHeight,
g.documentElement.clientHeight));var f;f=document;f=Math.max(Math.max(f.body.scrollWidth,f.documentElement.scrollWidth),Math.max(f.body.offsetWidth,f.documentElement.offsetWidth),Math.max(f.body.clientWidth,f.documentElement.clientWidth));b.add_event({key:"[CLY]_action",segmentation:{type:"click",x:a.pageX,y:a.pageY,width:f,height:g,domain:window.location.hostname}})}setTimeout(function(){d=!0},1E3)}})};b.track_links=function(a){a=a||document;m(a,"click",function(a){var e=R(a).closest("a");e&&(aa(a),
b.add_event({key:"linkClick",segmentation:{href:e.href,text:e.innerText,id:e.id,x:a.pageX,y:a.pageY}}),"undefined"!==typeof e.href&&"_blank"!==e.target&&!a.metaKey&&!a.altKey&&!a.ctrlKey&&!a.shiftKey&&0!==e.href.replace(window.location.href.split("#")[0],"").indexOf("#")&&b.end_session())})};b.track_forms=function(a){function d(a){return a.name||a.id||a.type||a.nodeName}a=a||document;m(a,"submit",function(a){var a=R(a),g={id:a.id,name:a.name,action:a.action,method:a.method},f;if("undefined"!==typeof a.elements)for(var c=
0;c<a.elements.length;c++)if((f=a.elements[c])&&"password"!=f.type)if("undefined"===typeof g["input:"+d(f)]&&(g["input:"+d(f)]=[]),"select"==f.nodeName.toLowerCase())if("undefined"!==typeof f.multiple){var h=[];if("undefined"!==typeof f.options)for(var i=0;i<f.options.length;i++)f.options[i].selected&&h.push(f.options[i].value);g["input:"+d(f)].push(h.join(", "))}else g["input:"+d(f)].push(f.options[f.selectedIndex].value);else"input"==f.nodeName.toLowerCase()?"undefined"!==typeof f.type?"checkbox"==
f.type.toLowerCase()||"radio"==f.type.toLowerCase()?f.checked&&g["input:"+d(f)].push(f.value):g["input:"+d(f)].push(f.value):g["input:"+d(f)].push(f.value):"textarea"==f.nodeName.toLowerCase()?g["input:"+d(f)].push(f.value):"undefined"!==typeof f.value&&g["input:"+d(f)].push(f.value);for(var k in g)"undefined"!=typeof g[k].join&&(g[k]=g[k].join(", "));b.add_event({key:"formSubmit",segmentation:g});b.end_session()})};b.collect_from_forms=function(a,d){a=a||document;m(a,"submit",function(e){var e=R(e),
g={},f=!1,c;if("undefined"!==typeof e.elements){var h={},i=a.getElementsByTagName("LABEL"),k;for(k=0;k<i.length;k++)i[k].htmlFor&&""!==i[k].htmlFor&&(h[i[k].htmlFor]=i[k].innerText||i[k].textContent||i[k].innerHTML);for(k=0;k<e.elements.length;k++)if((c=e.elements[k])&&"password"!=c.type&&-1==c.className.indexOf("cly_user_ignore")){var l="";if("select"==c.nodeName.toLowerCase())if("undefined"!==typeof c.multiple){l=[];if("undefined"!==typeof c.options)for(i=0;i<c.options.length;i++)c.options[i].selected&&
l.push(c.options[i].value);l=l.join(", ")}else l=c.options[c.selectedIndex].value;else"input"==c.nodeName.toLowerCase()?"undefined"!==typeof c.type?"checkbox"==c.type.toLowerCase()||"radio"==c.type.toLowerCase()?c.checked&&(l=c.value):l=c.value:l=c.value:"textarea"==c.nodeName.toLowerCase()?l=c.value:"undefined"!==typeof c.value&&(l=c.value);if(c.className&&-1!=c.className.indexOf("cly_user_")){c=c.className.split(" ");for(i=0;i<c.length;i++)if(0===c[i].indexOf("cly_user_")){g[c[i].replace("cly_user_",
"")]=l;f=!0;break}}else if(c.type&&"email"==c.type.toLowerCase()||c.name&&-1!=c.name.toLowerCase().indexOf("email")||c.id&&-1!=c.id.toLowerCase().indexOf("email")||c.id&&h[c.id]&&-1!=h[c.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(l))g.email||(g.email=l),f=!0;else if(c.name&&-1!=c.name.toLowerCase().indexOf("username")||c.id&&-1!=c.id.toLowerCase().indexOf("username")||c.id&&h[c.id]&&-1!=h[c.id].toLowerCase().indexOf("username"))g.username||(g.username=l),f=!0;else if(c.name&&
(-1!=c.name.toLowerCase().indexOf("tel")||-1!=c.name.toLowerCase().indexOf("phone")||-1!=c.name.toLowerCase().indexOf("number"))||c.id&&(-1!=c.id.toLowerCase().indexOf("tel")||-1!=c.id.toLowerCase().indexOf("phone")||-1!=c.id.toLowerCase().indexOf("number"))||c.id&&h[c.id]&&(-1!=h[c.id].toLowerCase().indexOf("tel")||-1!=h[c.id].toLowerCase().indexOf("phone")||-1!=h[c.id].toLowerCase().indexOf("number")))g.phone||(g.phone=l),f=!0;else if(c.name&&(-1!=c.name.toLowerCase().indexOf("org")||-1!=c.name.toLowerCase().indexOf("company"))||
c.id&&(-1!=c.id.toLowerCase().indexOf("org")||-1!=c.id.toLowerCase().indexOf("company"))||c.id&&h[c.id]&&(-1!=h[c.id].toLowerCase().indexOf("org")||-1!=h[c.id].toLowerCase().indexOf("company")))g.organization||(g.organization=l),f=!0;else if(c.name&&-1!=c.name.toLowerCase().indexOf("name")||c.id&&-1!=c.id.toLowerCase().indexOf("name")||c.id&&h[c.id]&&-1!=h[c.id].toLowerCase().indexOf("name"))g.name||(g.name=""),g.name+=l+" ",f=!0}}f&&(j("Gathered user data",g),d?b.user_details({custom:g}):b.user_details(g));
b.end_session()})};b.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(d){var e={};d.name&&(e.name=d.name);d.email&&(e.email=d.email);"male"==d.gender?e.gender="M":"female"==d.gender&&(e.gender="F");if(d.birthday){var g=d.birthday.split("/").pop();g&&4==g.length&&(e.byear=g)}d.work&&(d.work[0]&&d.work[0].employer&&d.work[0].employer.name)&&(e.organization=d.work[0].employer.name);if(a){e.custom={};for(var f in a){for(var g=a[f].split("."),c=d,h=0;h<g.length&&!(c=c[g[h]],"undefined"===
typeof c);h++);"undefined"!==typeof c&&(e.custom[f]=c)}}b.user_details(e)})};Element.prototype.closest||(Element.prototype.closest=function(a){for(var b=this,a=a.toUpperCase();b;){if(b.nodeName.toUpperCase()==a)return b;b=b.parentElement}});var m=function(a,b,e){"undefined"!==typeof a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent("on"+b,e)},R=function(a){return a?"undefined"!==typeof a.target?a.target:a.srcElement:window.event.srcElement},p=function(a,b,e){function g(a,b,c){var d=new Date;
d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var e=e||!1,f=!1,c;if("undefined"!==typeof localStorage){f=!0;try{localStorage.setItem("testLocal",!0)}catch(h){f=!1}}"undefined"!==typeof b&&null!==b&&("object"===typeof b&&(b=JSON.stringify(b)),f?localStorage.setItem(a,b):e||g(a,b,30));if("undefined"===typeof b){if(f)c=localStorage.getItem(a);else if(!e)a:{a+="=";b=document.cookie.split(";");e=0;for(f=b.length;e<f;e++){for(c=b[e];" "===c.charAt(0);)c=
c.substring(1,c.length);if(0===c.indexOf(a)){c=c.substring(a.length,c.length);break a}}c=null}try{c=JSON.parse(c)}catch(i){}return c}null===b&&(f?localStorage.removeItem(a):e||g(a,"",-1))}})(window.Countly=window.Countly||{});
